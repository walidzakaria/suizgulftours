<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Service</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- QR CDN -->
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  </head>
  <body>
    <header class="container-fluid">
      <div class="text-center">
        <h1 class="display-4">Service</h1>
      </div>
    </header>
    <button onClick="printReceipt()">Print</button>
    <div
      class="modal fade"
      id="modal-dialog"
      tabindex="-1"
      aria-modal="true"
      role="dialog"
      style="display: hidden"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modal-title">Modal title</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
              onClick="hideModal();"
            ></button>
          </div>
          <div class="modal-body">
            <p id="modal-message">
              Woohoo, you're reading this text in a modal!
            </p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              id="modal-btn"
              class="btn btn-primary"
              style="min-width: 120px"
              onClick="hideModal();"
            >
              OK
            </button>
          </div>
        </div>
      </div>
    </div>
    <main class="container-fluid">
      <div class="row content">
        <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12 sidenav">
          <h4 class="mt-2 mb-2">Booking Info</h4>
          <form id="search-code">
            <div class="input-group">
              <input
                type="text"
                id="guest-code"
                class="form-control"
                placeholder="Enter code.."
              />
              <span class="input-group-btn">
                <button
                  type="submit"
                  class="btn btn-outline-secondary"
                  type="button"
                >
                  üîç
                </button>
              </span>
            </div>
            <div id="guest-code-help" class="form-text text-danger hidden">
              Invalid code.
            </div>
          </form>
          <table class="table table-condensed mt-2">
            <tbody>
              <tr>
                <td>Name:</td>
                <td id="name-info"></td>
              </tr>
              <tr>
                <td>Dates:</td>
                <td id="dates-info"></td>
              </tr>
              <tr>
                <td>Hotel:</td>
                <td id="hotel-info"></td>
              </tr>
              <tr>
                <td>WhatsApp:</td>
                <td id="whatsapp-info"></td>
              </tr>
              <tr>
                <td>Egypt Phone:</td>
                <td id="phone-info"></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
          <h2>Services</h2>
          <div class="scrollable-content" style="overflow-y: auto">
            <table class="table table-condensed table-hover" id="service-table">
              <thead>
                <th>Select</th>
                <th>Service</th>
                <th>Service Date</th>
                <th>Adult</th>
                <th>Child</th>
                <th>Inf</th>
                <th>PUT</th>
                <th>P.Adult</th>
                <th>P.Child</th>
                <th>P.Inf</th>
                <th>Currency</th>
              </thead>
              <tbody></tbody>
            </table>
            <button
              id="btn-confirm"
              class="btn btn-primary m-2 col float-end"
              style="max-width: 120px; max-height: 40px"
              onClick="totalizeService(true)"
            >
              Confirm
            </button>
          </div>
        </div>
        <hr />
        <div class="row">
          <h3>Selected Services</h3>
          <hr />
          <div
            id="summary-services"
            class="col-lg-9 col-md-7 col-sm-12 col-xs-12"
          ></div>
          <div class="card col-lg-3 col-md-5 col-sm-12 col-xs-12">
            <div class="mb-3">
              <label for="branch-name" class="form-label">
                Branch Name <span class="text-danger">*</span>
              </label>
              <select
                id="branch-name"
                class="form-label form-select form-select-sm"
              ></select>
              <div id="branch-name-help" class="form-text text-danger hidden">
                This field is required.
              </div>
            </div>
            <table id="table-total" class="table table-condensed table-hover">
              <thead>
                <th>Currency</th>
                <th>Amount</th>
              </thead>
              <tbody></tbody>
            </table>
            <table
              id="currency-total"
              class="table table-condensed table-hover"
            >
              <thead>
                <th>Currency</th>
                <th>Paid</th>
              </thead>
              <tbody></tbody>
            </table>
            <table id="rest-total" class="table table-condensed table-hover">
              <thead>
                <th>Currency</th>
                <th>Rest</th>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <select
                      id="rest-currency"
                      class="form-control form-control-sm"
                    ></select>
                  </td>
                  <td id="rest-amount" style="font-weight: bold"></td>
                </tr>
              </tbody>
            </table>
            <button
              class="btn btn-primary"
              onClick="postService();"
              type="button"
            >
              CONFIRM BOOKING
              <div
                id="spinner"
                class="spinner-border spinner-border-sm hidden"
                role="status"
              >
                <span class="sr-only"></span>
              </div>
            </button>
          </div>
        </div>
        <div
          id="receipt"
          style="
            width: 80mm;
            background-color: gray;
            margin: 2px auto;
            font-family: serif;
          "
        >
          <img
            id="outputImage"
            alt="Converted Image"
            style="
              max-width: 100%;
              max-height: 60px;
              margin: 0 auto;
              display: block;
              font-size: 15px;
            "
          />
          <div
            id="receipt-branch"
            style="
              text-align: center;
              margin-top: 2px;
              border-bottom: 1px dashed black;
            "
          >
            <h3
              id="receipt-branch-name"
              style="font-size: 17px; font-weight: bold"
            >
              Hurghada Branch
            </h3>
            <p id="receipt-branch-address" style="line-height: 12pt">
              El Kahf St, Central Building, Hurghada, Red Sea
            </p>

            <p></p>
            <p id="receipt-branch-phone" style="margin-top: -12px">
              (012) 2123-8570
            </p>
          </div>
          <div
            id="receipt-header"
            style="
              border-bottom: 1px solid black;
              padding-top: 2px;
              padding-bottom: 2px;
            "
          >
            <div>
              <div style="display: inline-block" id="receipt-order">
                Order #21
              </div>
              <span id="receipt-date" style="float: right; text-align: right">
                26/Jan/2024 12:00AM
              </span>
            </div>
            <div>
              <div style="display: inline-block">Cashier: Online</div>
              <span id="receipt-date2" style="float: right; text-align: right">
                27/Jan/2024 02:11AM
              </span>
            </div>
          </div>
          <div id="receipt-details">
            <div
              style="
                border-bottom: 1px dashed black;
                padding-top: 2px;
                padding-bottom: 2px;
              "
            >
              <div style="font-weight: bold; display: block; width: 100%">
                Dolphin show + swimming 5
              </div>
              <div style="line-height: 12pt; width: 50%; display: inline-block">
                Friday, 26 January 2024
              </div>
              <div
                style="
                  line-height: 12pt;
                  width: 20%;
                  display: inline-block;
                  text-align: right;
                "
              >
                2 + 1
              </div>
              <div
                style="
                  line-height: 12pt;
                  width: 25%;
                  display: inline-block;
                  text-align: right;
                "
              >
                180.00
              </div>
            </div>
            <div
              style="
                border-bottom: 1px dashed black;
                padding-top: 2px;
                padding-bottom: 2px;
              "
            >
              <div style="font-weight: bold; display: block; width: 100%">
                Dolphin show + swimming 5
              </div>
              <div style="line-height: 12pt; width: 50%; display: inline-block">
                Friday, 26 January 2024
              </div>
              <div
                style="
                  line-height: 12pt;
                  width: 20%;
                  display: inline-block;
                  text-align: right;
                "
              >
                2 + 1
              </div>
              <div
                style="
                  line-height: 12pt;
                  width: 25%;
                  display: inline-block;
                  text-align: right;
                "
              >
                180.00
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </body>
  <script>
    let isSubmitted = false;
    let registrationInfo = {};
    let totalCurrency = {};
    let currencyExchange = [];
    let selectedServices = [];
    let availableServices = [];
    let branches = [];
    let selectedBranch = null;
    paymentInfo = {};
    $(document).ready(function () {
      getExchange();
      $("#rest-currency").change(function () {
        showRest();
      });
      getBranchOptions();
      selectedBranch = getCookie("branch") || 0;
      console.log("selected branch", selectedBranch);
      parseImg();
      $("#branch-name").change(function () {
        const branch = $(this).val() || 0;
        selectedBranch = branch;
        setCookie("branch", selectedBranch, 90);
      });
    });
    $("#search-code").submit(function (e) {
      e.preventDefault();
      isSubmitted = true;
      const code = $("#guest-code").val();
      $("#spinner").removeClass("hidden");
      resetInput();
      getRegistration(code);
    });

    function getBranchOptions() {
      $.ajax({
        url: "http://localhost:8000/api/branches/", // Your API endpoint URL
        type: "GET",
        dataType: "json",
        success: function (data) {
          branches = data;
          console.log(data);
          const branchInput = $("#branch-name");
          branchInput.empty();
          branchInput.append(
            $("<option>", {
              value: "",
              text: "Select Option",
            })
          );
          $.each(data, function (index, option) {
            branchInput.append(
              $("<option>", {
                value: option.branchnu,
                text: option.branchname,
              })
            );
          });
          branchInput.val(selectedBranch);
        },
        error: function (xhr, status, error) {
          console.error("Error:", status, error);
        },
      });
    }

    function getRegistration(code) {
      $.ajax({
        url: `http://localhost:8000/api/get-registration/${code}/`, // Your API endpoint URL
        type: "GET",
        dataType: "json",
        success: function (data) {
          registrationInfo = data;
          showGuestDetails();
          getService(registrationInfo.hotel_data.hotel_id);
        },
        error: function (xhr, status, error) {
          console.error("Error:", status, error);
          registrationInfo = {};
          showGuestDetails();
        },
      });
    }
    function getService(hotelId) {
      $.ajax({
        url: `http://localhost:8000/api/list-service/${hotelId}/`, // Your API endpoint URL
        type: "GET",
        dataType: "json",
        success: function (data) {
          availableServices = data;
          showAvailableServices();
        },
        error: function (xhr, status, error) {
          console.error("Error:", status, error);
          availableServices = [];
          showAvailableServices();
        },
      });
    }

    function selectRow(rowId) {
      const isChecked = $(`#check-${rowId}`).prop("checked");
      const adult = $(`#adult-${rowId}`);
      const child = $(`#child-${rowId}`);
      const inf = $(`#inf-${rowId}`);
      const dateInput = $(`#date-${rowId}`);
      if (isChecked) {
        adult.val(registrationInfo.adult);
        child.val(registrationInfo.child);
        inf.val(registrationInfo.inf);
        const currentDate = new Date().toISOString().split("T")[0];
        dateInput.val(currentDate);
      } else {
        adult.val(null);
        child.val(null);
        inf.val(null);
        dateInput.val(null);
      }
      adult.prop("disabled", !isChecked);
      child.prop("disabled", !isChecked);
      inf.prop("disabled", !isChecked);
      dateInput.prop("disabled", !isChecked);
    }
    function isValidServices() {
      let result = true;
      const tableRows = $("#service-table tr");
      tableRows.each(function (index, element) {
        const elementId = $(element).attr("id")?.substring(4);
        const isChecked = $(`#check-${elementId}`).prop("checked");
        if (isChecked) {
          const serviceDate = $(`#date-${elementId}`).val();
          console.log("serviceDate", serviceDate, ".");
          console.log("length", serviceDate.length);
          if (serviceDate.length === 0) {
            result = false;
          }
        }
      });
      return result;
    }

    function removeSummary() {
      $("#summary-services").empty();
      $("#table-total tbody").empty();
      showRest();
    }

    function totalizeService(scrollDown) {
      const dictCurrency = {};
      const tableRows = $("#service-table tr");
      selectedServices = [];
      const validInput = isValidServices();
      console.log(validInput);
      if (!validInput) {
        showModal("Error", "Some dates are missing!", "danger");
        removeSummary();
        return;
      }
      tableRows.each(function (index, element) {
        const elementId = $(element).attr("id")?.substring(4);
        const isChecked = $(`#check-${elementId}`).prop("checked");
        if (isChecked) {
          const adult = $(`#adult-${elementId}`).val();
          const child = $(`#child-${elementId}`).val();
          const inf = $(`#inf-${elementId}`).val();
          const serviceName = $(`#name-${elementId}`).text();
          const pAdult = $(`#p-adult-${elementId}`).text();
          const pChild = $(`#p-child-${elementId}`).text();
          const pInf = $(`#p-inf-${elementId}`).text();
          const currency = $(`#currency-${elementId}`).text();
          const prevValue = dictCurrency[currency] || 0;
          const pickupTime = $(`#put-${elementId}`).text();
          let price = parseFloat(adult) * parseFloat(pAdult);
          price += parseFloat(child) * parseFloat(pChild);
          price += parseFloat(inf) * parseFloat(pInf);
          const serviceDate = $(`#date-${elementId}`).val();
          dictCurrency[currency] = prevValue + price;
          selectedServices.push({
            id: elementId,
            service: serviceName,
            date: serviceDate,
            adult,
            child,
            inf,
            pickupTime,
            pAdult,
            pChild,
            pInf,
            price,
            currency,
          });
        }
        showRest();
      });
      showSummary();
      totalCurrency = dictCurrency;
      const tbody = $("#table-total tbody");
      tbody.empty();
      Object.keys(dictCurrency).forEach(function (key) {
        var value = dictCurrency[key];
        const newRow = $("<tr>");
        newRow.append(`<td>${key}</td>`);
        newRow.append(`<td>${value}</td>`);
        tbody.append(newRow);
      });
      if (scrollDown) {
        const selectedServicesSection = document.getElementById("btn-confirm");
        if (selectedServicesSection) {
          selectedServicesSection.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }
    }
    function getExchange() {
      $.ajax({
        url: "http://localhost:8000/api/list-exchange/", // Your API endpoint URL
        type: "GET",
        dataType: "json",
        success: function (data) {
          currencyExchange = data;
          showCurrency();
        },
        error: function (xhr, status, error) {
          console.error("Error:", status, error);
        },
      });
    }
    function showGuestDetails() {
      if (registrationInfo !== {}) {
        $("#guest-code-help").addClass("hidden");
        $("#spinner").addClass("hidden");
        $("#name-info").text(registrationInfo.guestname);
        $("#dates-info").text(
          `${registrationInfo.arrivaldate} to ${registrationInfo.departuredate}`
        );
        $("#hotel-info").text(registrationInfo.hotel_data.hotel);
        $("#whatsapp-info").text(registrationInfo.whatsappphone);
        $("#phone-info").text(registrationInfo.phoneegypt);
      } else {
        $("#guest-code-help").removeClass("hidden");
        $("#spinner").addClass("hidden");
        $("#name-info").text("");
        $("#dates-info").text("");
        $("#hotel-info").text("");
        $("#whatsapp-info").text("");
        $("#phone-info").text("");
      }
    }

    function showAvailableServices() {
      const tbody = $("#service-table tbody");
      tbody.empty();
      if (availableServices !== []) {
        availableServices.forEach((i) => {
          const newRow = $("<tr>").attr("id", `row-${i.id}`);
          newRow.append(
            `<td><input type="checkbox" onClick="selectRow(${i.id})" class="form-check-input row-check" id="check-${i.id}"/></td>`
          );
          newRow.append(`<td id="name-${i.id}">${i.name}</td>`);
          newRow.append(
            `<td><input type="date" id="date-${i.id}" class="form-control form-control-sm" style="max-width: 150px;" disabled/></td>`
          );
          newRow.append(
            `<td><input type="number" id="adult-${i.id}" min="0" class="form-control form-control-sm" style="width: 70px;" disabled/></td>`
          );
          newRow.append(
            `<td><input type="number" id="child-${i.id}" min="0" class="form-control form-control-sm" style="width: 70px;" disabled/></td>`
          );
          newRow.append(
            `<td><input type="number" id="inf-${i.id}" min="0" class="form-control form-control-sm" style="width: 70px;" disabled/></td>`
          );
          newRow.append(`<td id="put-${i.id}">${i.put || "00:00"}</td>`);
          newRow.append(`<td id="p-adult-${i.id}"> ${i.p_adult || 0}</td>`);
          newRow.append(`<td id="p-child-${i.id}"> ${i.p_child || 0}</td>`);
          newRow.append(`<td id="p-inf-${i.id}"> ${i.p_inf || 0}</td>`);
          newRow.append(`<td id="currency-${i.id}">${i.currency || 0}</td>`);
          tbody.append(newRow);
        });
      }
    }

    function showSummary() {
      const summaryDev = $("#summary-services");
      summaryDev.empty();
      selectedServices.forEach((i) => {
        summaryDev.append(`<div class="col-sm-10">
          <h4>${i.service}, <small>${i.date}, ${i.pickupTime}</small></h4>
          <p>Number of booked pax is (${i.adult} Adt, ${i.child} Chd, ${i.inf} Inf). Total amount: <b>${i.price} ${i.currency}</b>.</p>
          <br>
        </div>`);
      });
    }

    function showCurrency() {
      const tbody = $("#currency-total tbody");
      const currencySelect = $("#rest-currency");
      tbody.empty();
      currencySelect.empty();
      console.log("currency", currencyExchange);
      currencyExchange.forEach((i) => {
        const newRow = $("<tr>");
        newRow.append(`<td>${i.currency}</td>`);
        newRow.append(
          `<td><input type="number" onChange="showRest();" min="0" currency-data="${i.currency}" class="form-control form-control-sm paid-currency" style="width: 70px;"/></td>`
        );
        tbody.append(newRow);

        currencySelect.append(
          $("<option>", {
            value: i.currency,
            text: i.currency,
          })
        );
      });
    }

    function showRest() {
      paymentInfo = {};
      let priceInEgp = 0;
      let paidInEgp = 0;
      const selectedCurrency = $("#rest-currency").val();
      // get total in EGP
      selectedServices.forEach((i) => {
        priceInEgp += i.price * getExchangeRate(i.currency);
      });
      // get paid in EGP
      const payments = $(".paid-currency").each(function () {
        const currency = $(this).attr("currency-data");
        const value = $(this).val() || 0;
        paidInEgp += value * getExchangeRate(currency);
        paymentInfo[currency] = value;
      });
      const restInEgp = priceInEgp - paidInEgp;
      const restInSelectedCurrency =
        restInEgp / getExchangeRate(selectedCurrency);
      $("#rest-amount").text(restInSelectedCurrency.toFixed(2));
      paymentInfo["selectedRest"] = selectedCurrency;
      paymentInfo["rest"] = restInSelectedCurrency.toFixed(2);
    }
    function getExchangeRate(currency) {
      const exchangeRate = currencyExchange.filter(
        (c) => c.currency === currency
      )[0];
      return exchangeRate?.rate || 0;
    }

    function resetInput() {
      selectedServices = [];
      availableServices = [];
      showAvailableServices();
      totalizeService(false);
    }
    function parseImg() {
      let varbinaryText =
        "0xFFD8FFE000104A46494600010101006000600000FFE1005A4578696600004D4D002A00000008000401320002000000140000003E51100001000000010100000051110004000000010000000051120004000000010000000000000000323032333A30323A31392031303A34383A343700FFDB004300080606070605080707070909080A0C140D0C0B0B0C1912130F141D1A1F1E1D1A1C1C20242E2720222C231C1C2837292C30313434341F27393D38323C2E333432FFDB0043010909090C0B0C180D0D1832211C213232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232FFC0001108013F014603012200021101031101FFC4001F0000010501010101010100000000000000000102030405060708090A0BFFC400B5100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FAFFC4001F0100030101010101010101010000000000000102030405060708090A0BFFC400B51100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDA000C03010002110311003F00F7FA28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A322800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A0F4AAF777D6B61179B77711429EB23015C86ABF11AC600D1E9D135D49D37B7C883FA9FCBF1A4E496E26D2DCC8D5FC63ADE9DE24BA89B60B78E42A90140014ECD9EB9239AEBBC3FE26B7D661CA9DB20E190F506BC9755D62E354BAFB45E3A973F75117007B01D6BA3F02595DB5F35C14648CF406B3836DF91116DBF23D5FB579978A754D6F47F13C97297327D99C0F2D33FBBC01CA91EB9CF3EF5E98BC28AC7D7F48B7D4ECA44940E9D7D3DEAE4AEB42E4AE8A9E1CF1343ABC03276CA386527A1AE92BC222B89F46D4D8DBCCACD1B632A72AE2BD77C3BAC2EAB62920EB8E6942571465736A8A28AB2828A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A002A3B8996DEDE499BEEA2963F402A4AA9A94467D36E221D5E3651F88C5007866A5A95C6A57CF7772CD24D2B6401CE07A0F402B434BF0C6A3A990CCA628CFA75A8B4258BFB5E25B851D7183EB5ED363142B6E862518C76ACA114D5CCE114D5CE4B4AF015A5B10F2AEE6EF9AEA3658E8F68D2C8F1C1120E5D880055E3C0AF18F165F6A575AE5C437F21DB0B91146BC205EC40F71DEAE72E5454A5CA8EA757F8911A168B4AB7F34FF00CF69B217F05EA7F1C5715A86BBAA6B32ECB9BA965C9FF549C28FF808E3F3AA9A669F73ABDF1B74FDDA038273CB57A7E85E0CB4B0457740CDEA6A145CB59325272D59C0DA785F53BDDBB53CB53DF1CD7A6F863446D22CD6362738ADC8EDE2894054031ED52D68A296C5A496C1451453185145140051451400514514005145140051451400514514005145140051451400514514005145140051451400514514005145140051451400514514005232EE523D696B0754F1868DA533472DD09665EB14237B7E3D87E2693696E26D2382F17F87E6D3F5192F6DD4F93236F3B7F81BD6AD787BC70D66AB06A1B9907025519FCC7F851ABF8FDAFE368ADF4F4453FC7336E3F90FF1AE2669D558973F331CED51C9FC2B172B3F74C9BB3F74F7DB2BF82FE15921915D5864107AD739E2AF0BA6AA9E74636CCA3861FCAB9EF05EA69A75B937D7096F1755123807F2AE86F7E20E8B6EA442D2DCB7A46840FCDB15AB6ADA9A36ADA9E6AE97DA25F0FBD14AA783D9ABD27C2BE295D522114D859978615C1F883C48DADBE7ECB15BC4A7239DCDF89A5F07C73CDAD2C90AB796BC16C75ACE0FDEB2D888EFA6C7B4F5145323C88D73D714FAD8D428A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A69751D48A89AF6D94E0CF183EEC280396F1EEBF2697611D95AB94B8BACE5C1E51075C7B9E9F9D793A33CB3793044D2C9DC0E82BD57C69A743ACD92C96F246D710E4A104723B8AE7BC15A5ECBF91EE220093D0D64E3CD2D763371BCB531ACFC25AB5E005F1129FEE8E6B2A4812D6E2548C36518AB39E5891C57BEA45104C28038AC09FC276735C6FF29557716C01DCF26A9C3B68538F63C8A3B7B9B86FDD5BC8E4F722B4ADBC31AB5C91888460FB66BD7ADB46B3B6501225E3DAAEAC31A7DD403F0A1538A12844F35D37E1EB3B2BDDB96F635DCE97A1DAE9B181120047B56AE31455961451450014514500145145001451450014514500145145001451450014514500145145001451450014514500145145001451450014514500145151CF3476F04934AC1638D4B331EC0724D0060F8A7C551787628D12213DD4B92A9BB0147A9FF3CF35E75A878DB5BBC621AF7ECEA7A24036FEBD7F5ACFD73559B58D5A6BC20EE95B6C487F857B0FCABAAF0CF832336FF6ABC1B988C92D592BCDF919ABC9F91C5CB773DD1266B89653DCC8E5BF9D4581E9FA54F75224B7734918C46CE4A0F419E3F4A86B07B9932017506FDA18EE1DB61FF0AB705F4F030682E6589BB1572A6A3A956E1D4608575F465CD52E51AB1AD6BE2ED72D48DB7AD228FE195437EBD7F5ADFB1F8913A605ED9861DDA16FE87FC6B8B06D9CFEF2374F78DBFA55B8B4EB5B8005BDF0F30F4490609AB57E8CA57E8CF52D3FC67A45FE145CAC6E7F825F94FEBD7F0ADE49E390655C1CD784CFA65E407E681987AAF2292D751BEB07FF0046BA9A123F843103F11D2ABDA35F122B9DADD1EF745707E15F18CB7B20B5BDC79C3A30E035776A432823BD689A6AE8B4EEAE2D14514C61451450014514500145145001451450014514500145145001451450014514500145145001451450014514500145145001451450015C67C44D54DA68E9631B624BB6C363FB8393F99C0FCEBB3ED5E31E35D4FEDDE23BA6CE63B7FDCA7E1D7FF1E26A2A3B2226EC8ABE1AB1FED0D6D148CA47D7EB5ED30DBAC76A22006318AE13E1EE92D1C06E645F99CE6BD0EAA2ACAC5256563CD359F02379ED258011A939D9D4572D79A1EA1644F9B6EC40EEB5EE6403D4543359C130C3A039F6A9708B138267809E0E0820FA1A2BD8351F07D85E827CA507D40AE4751F015C4196B57247A37359BA4FA19BA6FA1C6D1572E74ABEB46226B7718EE064552242FDEF97EBC566E2D10E2D1D678635C1E7AD9DEE1D5B8466EBF4AD9F1969161068AD7C88049B95531EA4FF00866BCFECB7CB7F0A400B36F0495E82BBFF0019EF5F095A2BF5F3D73FF7CB56C9BE4D4D537C9A9C5E865BFB76D42939C9CFE95EE16B9FB3A67D2BC2B4CBA5B1D4A1B9704AA7502BD46C7C75A2C91AA3DC989B1D24423F5E945392E5B041AB1D551546D757B0BD19B6BA865C75D8E1B1F955D0411915A9A0B4514500145145001451450014514500145145001451450014514500145145001451450014514500145158FAB789F4AD1894B9B90661FF002CA3F99FF2EDF8E286EC0DD8D8A2BCE2F7E25CAC4AD858003B3CED9FFC747F8D625C78CFC43747E5B9F281FE18A203F5393FAD473AE8473AE87B0EE1EA290C8A3F8857893EABAFCFF7AFAF8E7FBB232FF2AAB245A94FFEB56E64FF007989FE7473BEC1CCFB1ECBAAEB569A7D85C4CD3C5E6471B32A171962070315E228AD737712312CD2499627BF7343DBCD0E3CC81D01E85855EF0F41F69F10C0A46428CFE67FFAD5177292B9376E4AE7B0E876CB6DA6C4A063E5AD3A8ADD36408BE82A5AD8D428A28A00290807A8A5A2802B4D616F38F9E353F8565CFE16D3E73930AFE55BB5CF5E78BECACF5F1A43C5379BC6E93036025770EF9FD2936909BB12D9F862C2CE4DE91283F4A7F887458B56D29AD5C1E0EE523AA91DEB56199668C3A9C83599E27D4A5D27C3D77790E3CD4501323382582E7F0CD0ED6D41EDA9E39AAE9F2E997AD6CD246CCBD4771F5ACF9A75876655DB79C0DA3353BBBCB23492317763B9998E493EB447B7ED10E467F78302B9959C8C159B1D04D35B4AB342CF148BC823835EA1E0FF00123EA70F9539FDF2F0DEF5CA78B6DE082CF4D6450B248189C7A0C7F8D4DF0FA077BF9A5FE1DD8AD60AD2691A455A563D5A8A074A2B5340A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A28031FC517EFA6F86EF6E232C2411EC465EAACC7683F86735E27F3CB711AF2CF23F2C79AF79D4ED12FB4F9ADDC656452A47D6BC42FEC67D2AFDEDE5043A1CAB7A8EC45655346999CF74CEEB48F0545240924C73919AE8A0F0B584207EE94FE15CBF863C6B1A2A5ADFB0461C073F74FF857A0437314E8191C107D0D689A6B42D34F62A2E8B669D225FCAA51A65A8FF964BF955CA298CE0BE22DA436FA3DB3468149B90381FECB5731E098C36BCCC7B015E87E30D29B56D11E24E2442244CFA8FF00EB135E51617D71A3DF9962551229DACAE3D2B293E59DD99B7695D9EEEBF747D296B81D3BE23DB3054BDB79213DD97E75FF001FD2BAAB0F1069BA8AE6DAEA373FDD0DC8FC3AD68A49EC5A927B1A945355D587041A7531851451400C96458A2691D82AA82493D85789DD5F3EAFE2596F54106697283B851C0FD00AF5AF11DBCF77A05E5BDB3059648CA827BFA8FC471F8D798683A35D8D6A313425761E73CD44937244BBB68F55D1E368F4F8C375C555F1145697DA6CDA74D711A49326554B80DC1E081F515AB02EC8557D05791F8F727C5531639FDDA63D8629CE56412764675CF87B5186631C68B20CF0DD3F4AD2D23C2AD0DC25E6A73C71A2723710AA3F3AE645EB44FE52DC481BFBA8C7FA539BCD90EE64958FA9524D649DB551334EDB2353C49AAAEA5A997873F67857CA87DC7AFE27F4C5775E02D38DB69E246182DCD717E1DF0EDD6A57A924D114854E4035EC1636AB696CB1A8C6056904D6ACD229AD59668A28AB2828A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A002B9EF10786ADF5788E546F1D187515D0D1401E2DA9785B50B076DB199107423AD56B2D5F55D19C2C33491A8FF966E32BF91FE95EDD2411CA30CA0D64DFF86AC6F508689727DAB374D74D08E45D0E4F4DF88E461350B623D5E2E47E47FF00AF5D769FE26D2F510041771B31FE1270DF91E6B8AD4FC0324659ED18E3FBA7915CADDE8F7D64C44B6ED81DD46695E71DF515E4BCCF73DD1CAB8C820D721E20F06C3A83B4F0FC929EEBDEBCF6D35CD52C08105F4C98FE063B80FC0D74165F10F518702EA08A751DD4943FD451ED22F461CE9EE62DFF0087351B063BA12EA3BAD651DD1B8CEE47078CF06BD32DFC75A35E0DB771C9013D77A647E633565F4FD035B4260960933FDC6048A5C9196CC5C917B1C0D978A358B0C08EF1DD47F0CBF38FD79FD6BA2B2F8933A605E5906F5689B1FA1FF1A92EFC011365ADA52BE801AC4B9F056A706761571EE28E59AD9872CD6C76B6DF10B46980F35E584FA3C67FA66AF2F8CF426C7FC4C2219F5C8FE95E533687A9C27E6B563F43551ED6EA33F3DB4A3FE034F9A6BA0F9A7D8F71B7D5B4FBE5FF0047BA8661DF6386FE552476D6CB26F50BBBD6BC17E6439DB2291DF69AB916B3A95B8C45A85DA0F4F31B1F951ED1F541CEFAA3DC2F6FADB4FB492E6E6558E28C64927FCF35E1FAB6A0FAA6AB737AE08F35F201ECBD00FCB150DD6A5757A41BBBB966C74123938FA557114D76C20B556323F1B80E16A64DCDD92264DCB42E6912DA586A1E74F06F47396EE47BD7ABE970E8FA8DBAC9008D811DABCF97C17A9ADA09776F38E84552B5BCD47C3F7B95DD1B67E646FBAD549CA1F16C526E3B9ED705A436E311A01F4A9EBCF93E24C31C283EC52C8F8F9BE6000FF1ABD67F1174C9D82CF1CD6E4F775C8FCC55F3C7B95CC8ECE8ACBB6F10E9574CAB0DFDBBBB745128C9FC2B456447195606A8A1F4514500145145001451450014514500145145001451450014514500145145001451450014514500145145002100F5155E6B1B79C61E353F8559A28039BBEF07E9F760E62504FB570BE28F0B1D1234B88B2622DB5BDBD2BD7AB3F59D3A3D4F4E96DA45CABAE2A651BAB0A4AE8F0AA012AC181208E8455DD4F4BB8D2AE9E19D4ED07E57C704552AE569ADCE76AC6A5A788F57B2C7957D2951FC321DE3F5ADEB5F8897C98175670CA3D518A9FD735C6D154A725D46A4D1E91078FB499801736B3447B9DA187E873FA55F8F5FF0C5DFFCBCC2B9FF009E80A7F302BCA28AA556457B467B0A43A05D7FAB9AD5F3FDD7534F3E1DD29F9F2D0E7DABC6F03D2955993EEB15FA1C557B6F21FB4F23D80F85B4B3FF002CD3F2AB36BA0E9D6AFB9234047B578D7DA6E0749E5FFBECD21B89D860CF291EEE68F6DE41ED3C8F78926B5823FDE491A28EEC4015C0F8DAF7439ED4C704F1CD779057C93BB6FD48E2B813C9C9E4FA9A293AB756B09D4BA0A28A2B2330AD6D3BC4BAAE984086E99E31FF002CE5F987F88AC9A284DAD869B47A5E93F10ED66DB1DF21B773C6EEAA7F1ED5D8DB5F5BDDC6B24322BAB0C82A720D781D5CD3F55BDD2E5DF693B273929D54FD456B1AAFA9A2A9DCF79A2B86D07C7905D1582F408663C024FCADF435DAC5324C8190820D6C9A7B1A269EC4945145318514514005145140051451400514514005145140051451400514514005145140051451400514514019BA868D6BA82912C60FE15CDDCFC3EB190928BB4FA8E2BB6A2803CCAE3E1DCAB9F26771F5E6B267F056A90FDC2AFF00515EC748554F502A5C62FA13CA8F0E97C3BAB45D6D777D0D566D2F515EB66FF857BB98223D507E5519B280F58D7F2A5ECE22E489E15FD9F7E39367201503AB4670E8EA7DD48AF7B3616C463CB5FCAA94FE1FB19FEF42BF95274A21ECD1E1DBD3FBCBF9D3BAD7AFCBE0BD364FF962BF95509BE1EE9EFCAA007DAA7D8F993ECCF2FA2BBBBBF87654136F2B8F627358371E10D5A172151587D0D4BA5213A6CC2A2B51BC37ABAFFCBB83F8D34F87F571FF002E9FF8F7FF005A97B390B92466D15A3FF08F6AE7FE5D40FF00817FF5A9EBE19D65BA40A3EB9A3D9C8392465D15B69E0FD664EA117E8A6AE43E01D4A4FF0059391F40053F6521FB36731DB9AF4AF00EA73DD5A797231655E031EE2B3ED7E1BA920CF2BBFB33135DB68FA241A54212250315A421CA5C63CA6AD14515A1614514500145145001451450014514500145145001451450014514500145145001451450014553BEB99209EC5108C4D71E5BE476D8C7F9815729D8028AAF0DF5A5C4AD1417504B22FDE4490123F014497F670CEB04B75024CD8C46D200C73D38A2CC0B145579EFACED5D52E2EA0859B902490293F9D58A4014556825090CD24F771488B2365C6142007EE9E7A8E94FB7BBB6BB42F6D7114CA0E098DC3007F0A76026A2B275BD467D38DA3440323487CD18C9D814B363DF009AD50CA537861B719CE78C50D3B5C2E2D1597A36A32EA26EDDC011ACA04431CEC2A0A93F5073F8D5B5D42C9EE3ECE977034C0E3CB1202DF950E2D3B0AE59A698D0F5514C96EADE0DDE74F147B5771DEE0606719E7B669B35F5A5BC6924D750C71BFDC679000DF427AD16631FE4C7FDC1F951E445FDC1F9555D4EF1ADF4A7B9B7752729B5BA820B01FC8D5EA2DA5C08FC88BFB83F2A5F263FEE0A7D148068451FC229703D2968A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A0028A28A00CDD53FE3EB4BFFAFBFF00DA6F46BEF247A25C18CE18ED52738C29600F3DB826ACDE59437C91ACA641E5BEF568DCA10704751CF426990E9B0C492A179E649576B2CF334831FF000226AD35A08A0D65A8C8F683ECD61025BCAACAD14AC4AA83F300360EA3229583E9335C493C09359CF3798D28FBF19381F303D4038E474F4AB906950C122309AE5D63FB88F33155FC3BFE39A1F4A82498BC925C3A17DE6169494CE73D3D33CE3A53E642B152E925D3AE6F2F5ADD2E6D2601A603EFC61570783C32E0671C7535B0AC1D4329CA91906A94FA5C37323B492DC6C93EFC426608DF87F855D0000001803A0152DA6868C182CE4BCD3AE162641247A8CB228907CAC5642707DAB4AC2EFED124F1C96DF67B988AF9A99041CF4218751D69C74E83C86891A58C34AD36E8E42A431249E7F13C74A7DAD94569BCA176790E5E4918B3363A64D3724D02454D49436A9A4AB0054CB2020F7FDD3551DEE2D0E85B8F9DE6F901B3CF918DDBBFEF8F97EB5B92DB4734D04CE097858B21CF424107F42693ECB0FDB3ED7B079FE5F97BFF00D9CE71F9D0A4AC1630AE59ADED75F30129B5D002BFC2BE5A0247D066AFEA56B6B1787EE11111238612F115E361032083EB9ABC9690A3DC304CFDA0E640790DF285E9F41551346B54DAA5A7785082B03CAC5063A71DC0F43C53E642B15923FB47886DDEE10175B10C548E036EEBFCEA35FB63EBBA835BC16B218BCB8D7CE9194A26D0700053C124FE5ED5B3F668FED7F6AC1F37CBF2F39FE1CE6A1B9D3A1B99C4FBE58A60BB4C90B95247A1F5A5CC82C678D3AED747B9B668E10EF389238A27CAA2EE5240240EFB8D6DD553A7C26C8DA6E9761392DE6B6F2739CEECE7AD5AA4DDC690514515230A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2800A28A2803FFFD9";
      varbinaryText = varbinaryText.replace(/^0x/, "");

      // Convert hex to Uint8Array
      let uint8Array = new Uint8Array(varbinaryText.length / 2);
      for (let i = 0; i < varbinaryText.length; i += 2) {
        const byte = parseInt(varbinaryText.substr(i, 2), 16);
        uint8Array[i / 2] = byte;
      }

      const blob = new Blob([uint8Array]);
      const dataURL = URL.createObjectURL(blob);

      // Display the converted image
      document.getElementById("outputImage").src = dataURL;
    }
    function isValidServicePost() {
      if (!registrationInfo.guestinfoid > 0) {
        showModal("Error", "Please enter booking!", "danger");
        return false;
      }
      if (!selectedBranch > 0) {
        showModal("Error", "Please select branch!", "danger");
        return false;
      }
      if (selectedServices.length === 0) {
        showModal("Error", "Please select services!", "danger");
        return false;
      }
      return true;
    }
    function postService() {
      if (!isValidServicePost()) {
        return;
      }
      console.log(registrationInfo);
      $("#spinner").removeClass("hidden");
      const requestData = {
        bookingId: registrationInfo.guestinfoid,
        hotel: registrationInfo.hotel_data,
        country: registrationInfo.country,
        date: new Date().toISOString().split("T")[0],
        branch: selectedBranch,
        services: selectedServices,
        payment: paymentInfo,
        exchange: currencyExchange,
      };
      console.log(requestData);
      $.ajax({
        url: "http://localhost:8000/api/create-service/", // Your API endpoint URL
        type: "POST",
        // dataType: 'json',
        contentType: "application/json",
        data: JSON.stringify(requestData),
        // data: requestData,
        success: function (data) {
          console.log(data);
          $("#spinner").addClass("hidden");
          showModal("Success", "Saved successfully!", "success");
          resetInput();
        },
        error: function (xhr, status, error) {
          showModal("Error", "Error saving your services!", "danger");
          $("#spinner").addClass("hidden");
          console.log(error);
        },
      });
    }

    function setCookie(name, value, daysToExpire) {
      let cookie = `${encodeURIComponent(name)}=${encodeURIComponent(value)};`;

      if (daysToExpire) {
        const expirationDate = new Date();
        expirationDate.setDate(expirationDate.getDate() + daysToExpire);
        cookie += `expires=${expirationDate.toUTCString()};`;
      }

      document.cookie = cookie;
    }

    function getCookie(name) {
      const decodedName = encodeURIComponent(name);
      const cookies = document.cookie.split(";");

      for (const cookie of cookies) {
        const [cookieName, cookieValue] = cookie
          .split("=")
          .map((part) => part.trim());
        if (cookieName === decodedName) {
          return decodeURIComponent(cookieValue);
        }
      }

      return null;
    }

    function hideModal() {
      $("#modal-dialog").removeClass("show");
      $("#modal-dialog").css("display", "none");
    }

    function showModal(title, message, status) {
      $("#modal-title").text(title);
      $("#modal-title").removeClass();
      $("#modal-title").addClass("modal-title");
      $("#modal-title").addClass(`text-${status}`);
      $("#modal-message").text(message);
      $("#modal-btn").removeClass();
      $("#modal-btn").addClass("btn");
      $("#modal-btn").addClass(`btn-${status}`);
      $("#modal-dialog").addClass("show");
      $("#modal-dialog").css("display", "block");
    }

    function printReceipt() {
      // Get the HTML content of the specific div
      const divToPrint = document.getElementById("receipt");
      const newWin = window.open("", "Print-Window");
      newWin.document.open();
      newWin.document.write(
        '<html><body onload="window.print()">' +
          divToPrint.innerHTML +
          "</body></html>"
      );
      newWin.document.close();
      setTimeout(function () {
        newWin.close();
      }, 10);
    }
  </script>
  <style>
    .hidden {
      display: none;
    }
    .card {
      margin: 10px auto;
      padding: 40px;
      border-radius: 20px;
      background: #f5f7f7;
    }
    .info-labels {
      font-weight: bold;
    }

    #service-table {
      max-height: calc(100vh - 220px);
      overflow: auto;
      display: inline-block;
    }

    .row.content {
      height: calc(100vh - 110px);
    }

    /* Set gray background color and 100% height */
    .sidenav {
      background-color: #f1f1f1;
      height: 100%;
    }

    /* Set black background color, white text and some padding */
    header {
      background-color: #555;
      color: white;
      padding: 15px;
    }

    .sidenav {
      min-height: 350px;
    }
  </style>
</html>
